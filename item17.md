# 변경 가능성을 최소화하라

---

### 불변 클래스란?

인스턴스 내부 값을 수정 할 수 없는 클래스

> 설계, 구현, 사용하기 더 쉽고 훨씬 안전하다.

---

### 불변 클래스 생성 규칙

1. 객체의 상태 변경 메소드(변경자) 제공 X
2. 클래스 확장 불가능
3. 모든 필드 `final`
4. 모든 필드 `private`
5. 자신 외에는 내부 가변 컴포넌트에 접근 불가

---

### 불변 객체의 특성

* 불변 객체는 근본적으로 스레드 세이프 하여 동기화할 필요 X 
  > 안심하고 공유 가능
* 자주 사용하면 캐싱 할 수 있도록 정적 팩토리 메소드 제공 가능
* 불변 객체는 방어적 복사 필요 X
* 불변 클래스는 `clone` 메소드나 복사 생성자를 제공 하지 않는게 좋음
* 불변 객체는 자유롭게 공유 가능 하며 불변 객체 끼리 내부 데이터 공유 가능
* 객체를 만들때 다른 불변 객체를 구성요소로 사용하면 불변식 유지하기 쉬움
* 불변 객체는 실패 원자성을 제공
  > 실패원자성 이란 메서드에서 예외 발생해도 그 객체는 호출전과 같이 유효한 상태여야함
  > 
  > 불변 객체의 내부 상태를 바꾸지 않기 때문에 성질을 만족함
* 단점으로 값이 다르면 반드시 독립된 객체로 만들어야함


### 주의 사항
> 직렬화시에 가변 객체 참조가 있다면 `readObject` 나 `readResolve` 제공 해야함

---

### 정리

* 클래스는 꼭 필요한 경우가 아니라면 불변으로 만들자
  > `getter` 가 있다고 `setter` 를 만들지 말자
* 단순 값객체의 경우 항상 불변으로 하자 
* 성능이 아쉬운 경우는 가변 동반 클래스를 제공하자
* 불변으로 만들 수 없다면 변경할 수 있는 부분을 최소한으로 하자
* 다른 합당한 이유가 없다면 모든 필드는 `private final` 
* 생성자는 불변식 설정이 모두 완료된, 초기화가 완벽히 끝난 상태의 객체를 생성하자  

---

[스터디 발표 소스 repository](https://github.com/EffectiveStudy/leesangho/tree/main/src/main/java/com/github/sangholee/dev/effectivejavastudy/study03_item17)
