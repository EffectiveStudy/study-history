# Reflection보다 Interface

## TL;DR

리플렉션은 객체생성에만 이용하고, 객체 사용에는 인터페이스를 이용하자.

- 리플렉션은 어쩔 수 없이 사용해야 할 경우에만 이용하고, 되도록 `객체 생성`에만 이용하자.
- `객체 사용`시에는 , **컴파일타임**에 알 수 있는 `상위 클래스 or 인터페이스`로 캐스팅 하여 사용하자.

## Q. 왜 객체 생성에만 이용해야 하나요?

- 리플렉션은 안정성,성능,보안등 많은 단점이 존재하기에, 아주 제한된 형태로만 사용하여 `단점을 피하고 이점만 취하기 위해`.
- 즉, 컴파일타임에는 알 수 없거나 존재하지 않는 클래스를 런타임시에 객체생성하기 위해서만 이용하자.

## 예제 : 리플렉션으로 생성, 인터페이스로 사용하는 예제

[ 설명 ]

- Set<String> 인스턴스 생성프로그램. 구현체 클래스는 커맨드라인의 입력을 이용해 생성.
- 객체 생성은 리플렉션 이용.
- 객체 사용은 Set<String> 인터페이스 이용.

[ 코드 ]

- Refer `RefelectionTest#testConcreteSet()`

[ 예제에서 보여주는 리플렉션의 단점 ]

1. 너무 많은 런타임 예외 
   - 객체 생성만으로도 발생 가능한 런타임예외가 6가지. 
   - 리플렉션이 아니라면 모두 컴파일타임에 잡아낼수 있는 예외들.
   - -> `ReflectionOperationException` 상위 예외만을 잡도록 할 수는 있다.
2. 장황한 코드
   - 클래스 이름을 이용해 인스턴스 생성까지 25줄이나 작성.
   - 리플렉션이 아니라면 생성자 호출 1줄로 끝났을 일.

## Q. Reflection? What/Why/How?

[ What ]
- 런타임에, 임의의 Class 객체를 이용해, 해당 클래스의 생성자, 메서드, 필드등에 접근, 조작할수 있는 기법.
- 이를 통해 해당 클래스의 객체를 생성하거나, 메소드 호출 등의 작업이 가능.

[ When to use?]
- 컴파일타임에는 알 수 없는 (존재하지 않던) 클래스를 이용하고 싶을 경우.
- UseCase :
  - 프레임워크, 라이브러리 : 유저가 개발한 클래스를 알지 못하기에, 리플렉션을 이용해 동적으로 로드 및 실행.
  - JDK Dynamic Proxy
  - 객체 직렬화(역직렬화)
  - 코드 분석 및 테스트

[ Pros ]

- 컴파일타임에는 알 수 없는 (존재하지 않던) 클래스를, 런타임에 동적으로 접근 가능.
- 기존 클래스의 코드 변경 없이, 부가기능을 동적(런타임)으로 제공 가능

[ Cons ]

- 안정성 : 
  - 컴파일시점에 타입체킹 불가하기에,
  - 런타임시 존재하지 않은 or 접근 불가능한 메서드 호출 시도시, 런타임 오류 발생 가능.
- 성능 :
  - 런타임 오버헤드, 객체생성 오버헤드, 동적 메소드 호출로 인한 최적화 불가.
- 보안 :
  - 접근제어 우회, 보안 매니저 우회, 코드 주입등이 가능해지기에 보안 취약점 발생.
  - SonarQube와 같은 코드 분석 프로그램에서는 리플렉션 코드를 지양하라고 제시한다.
- 캡슐화 :
  - 접근제어 우회등을 통해 private한 필드, 메서드에도 접근이 가능해지기에 캡슐화를 깨뜨린다.
- 가독성 :
  - 리플렉션 이용시 코드가 지저분하고 장황해진다

[ How: 리플렉션, 어떻게 쓰죠?]

- Heap영역에 로드된 Class 타입 객체를 이용해 리플렉션을 사용할수 있다.
- 해당 객체를 획득하기 위해서는 다음 3가지 방법 존재.
  1. `클래스.class`
  2. `인스턴스.getClass()`
  3. `Class.forName("클래스명")`
- 해당 Class 객체를 이용해 Constructor, Method, Field 인스턴스 접근 및 조작 가능.

[ Refer ]
- https://kmongcom.wordpress.com/2014/03/15/%EC%9E%90%EB%B0%94-%EB%A6%AC%ED%94%8C%EB%A0%89%EC%85%98%EC%97%90-%EB%8C%80%ED%95%9C-%EC%98%A4%ED%95%B4%EC%99%80-%EC%A7%84%EC%8B%A4/

## Q. Class 타입 객체?

- Reflection API의 엔트리 포인트.
- 특정 클래스의 런타임 속성을 조회, 조작, 검사할수 있는 불변 객체
- 클래스로더에서, 클래스 파일에 대한 로딩 완료시, 해당 클래스 타입 불변 Class 객체를 생성하여 Heap에 저장.
- https://docs.oracle.com/javase/tutorial/reflect/class/index.html
- https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html
